{% extends "base.html" %}
{% block title %}{% if category %}{{ category.name }} — {% endif %}Products{% endblock %}
{% block content %}
<div class="row">
  <aside class="col-lg-3 mb-3">
    <div class="card card-pjp p-3 pjp-sidebar">
      <h5>Categories</h5>
      <ul class="list-unstyled mb-0">
        <li class="mb-2"><a href="{% url 'core:product_list' %}" class="{% if not category %}fw-bold{% endif %}">All</a></li>
        {% for c in GLOBAL_CATEGORIES %}
          <li class="mb-2"><a href="{% url 'core:product_list_by_category' c.slug %}" class="{% if category and c.slug==category.slug %}fw-bold{% endif %}">{{ c.name }} <small class="text-muted">({{ c.count }})</small></a></li>
        {% endfor %}
      </ul>
    </div>
  </aside>

  <section class="col-lg-9">
    <form method="get" class="mb-3 d-flex gap-2">
      <input name="q" value="{{ query }}" class="form-control" placeholder="Search products...">
      <select name="sort" class="form-select" style="width:140px;">
        <option value="new">Newest</option>
        <option value="az">A → Z</option>
        <option value="za">Z → A</option>
      </select>
      <button class="btn btn-pjp">Search</button>
    </form>

    <div class="row">
      {% for product in products %}
        <div class="col-md-3 mb-4">
          <div class="card card-pjp">
            {% if product.image %}
              <img src="{{ product.image.url }}" class="card-img-top" style="height:190px;object-fit:cover;">
            {% else %}
              <img src="{% static 'images/placeholder.png' %}" class="card-img-top" style="height:190px;object-fit:cover;">
            {% endif %}
            <div class="card-body">
              <h6 style="color:var(--pjp-text-dark)">{{ product.name }}</h6>
              <p class="mb-1">₹{{ product.get_price }}</p>
              <div class="d-flex gap-2">
                <button class="btn btn-pjp add-to-cart" data-id="{{ product.id }}">Add to cart</button>
                <a href="{{ product.get_absolute_url }}" class="btn btn-outline-secondary">View</a>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <nav>
      <ul class="pagination">
        {% if products.has_previous %}
          <li class="page-item"><a href="?page={{ products.previous_page_number }}" class="page-link">Prev</a></li>
        {% endif %}
        <li class="page-item disabled"><span class="page-link">Page {{ products.number }} of {{ products.paginator.num_pages }}</span></li>
        {% if products.has_next %}
          <li class="page-item"><a href="?page={{ products.next_page_number }}" class="page-link">Next</a></li>
        {% endif %}
      </ul>
    </nav>
  </section>
</div>
{% endblock %}
